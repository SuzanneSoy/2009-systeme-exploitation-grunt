.PHONY: all
all: $(IMAGE_CDROM)

.PHONY: clean
clean:
	@echo "    Suppression..."
	@$(RM) $(RM_OPTS) -rf $(REP_A_SUPPRIMER)
	@$(MKDIR) $(MKDIR_OPTS) $(REP_A_SUPPRIMER)

.PHONY: test
test: $(IMAGE_CDROM)
	@$(call AFFICHE_TT,$<,$@)
	@sync
	@$(EMU) $(EMU_OPTS) -cdrom $< -boot d



-include $(DEPENDANCES)



$(IMAGE_CDROM): $(FICHIERS_ISO)
	@$(call AFFICHE_CD,$^,$@)
	@$(MKDIR) $(MKDIR_OPTS) $(dir $@)
	@$(GEN_ISO) $(GEN_ISO_OPTS) -o $@ -graft-points -path-list $(LISTE_FICHIERS_ISO)

$(POLICE_FNT): $(OBJETS_FNT)
	@$(CAT) $(CAT_OPTS) $^ > $@

$(NOYAU_ELF): $(OBJETS_LD)
	@$(call AFFICHE_LD,$^,$@)
	@$(MKDIR) $(MKDIR_OPTS) $(REP_DIST)
	@$(LD) $(LD_OPTS) -o $(NOYAU_ELF) -T $(SCRIPT_LD) $^



.PRECIOUS: %.dir
%.dir:
	@$(MKDIR) $(MKDIR_OPTS) $(dir $@)
	@$(CREATE_FILE) $(CREATE_FILE_OPTS) $@

$(REP_TRAVAIL)/%.c.o: %.c $(REP_TRAVAIL)/%.dir $(MAKEFILES)
	@$(call AFFICHE_CC,$<,$@)
	@$(CC) $(CC_OPTS) -MMD -MF $(@:.o=.d) $(CC_INCLUSIONS) -c $< -o $@

$(REP_TRAVAIL)/%.S.o: %.S $(REP_TRAVAIL)/%.dir $(MAKEFILES)
	@$(call AFFICHE_AS,$<,$@)
	@$(CC) $(CC_OPTS) -MMD -MF $(@:.o=.d) $(CC_INCLUSIONS) -c $< -o $@ -DASM

$(REP_TRAVAIL)/%.fnt.o: %.fnt $(REP_TRAVAIL)/%.dir $(MAKEFILES) $(FN)
	@$(call AFFICHE_FN,$<,$@)
	@$(FN) $(FN_OPTS) $< $@

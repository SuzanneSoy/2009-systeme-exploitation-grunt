#!/bin/sh

if [ "$1" == "--help" ]; then
	echo "$0 catÃ©gorie/nomModule"
	exit
fi

n="$(basename "$1" | dd bs=1 count=1 2>/dev/null)"
omMod="$(basename "$1" | dd bs=1 skip=1 2>/dev/null)"

N="$(echo "$n" | tr '[:lower:]' '[:upper:]')"
OMMOD="$(echo "$omMod" | sed -e 's/[A-Z]/_\0/g' | tr '[:lower:]' '[:upper:]')"

nomMod="$n$omMod"
NomMod="$N$omMod"
NOMMOD="$N$OMMOD"

NOMCAT="$(echo "$1" | sed -e 's/[A-Z]/_\0/g; s|/|_|g' | tr '[:lower:]' '[:upper:]')"

destc="src/modules/$1/$nomMod.c"
desth="src/inclusions/$1/$nomMod.h"

[ -e "$destc" ] && echo "$destc existe !" && exit
[ -e "$desth" ] && echo "$desth existe !" && exit

mkdir -p "$(dirname "$destc")"
mkdir -p "$(dirname "$desth")"

echo --------------- "$destc" ---------------
cat src/modules/modeleModule.c | sed -e "s|modeleModule|$1/$nomMod|g; s/ModeleModule/$NomMod/g; s/MODELE_MODULE/${NOMCAT}_$NOMMOD/g" | tee -a "$destc"
echo
echo --------------- "$desth" ---------------
cat src/inclusions/modeleModule.h | sed -e "s|modeleModule|$1/$nomMod|g; s/ModeleModule/$NomMod/g; s/MODELE_MODULE/${NOMCAT}_$NOMMOD/g" | tee -a "$desth"

geany "$destc" "$desth" &
